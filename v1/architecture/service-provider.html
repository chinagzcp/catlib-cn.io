<!doctype html>
<html lang="en">
  <head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="utf-8">
    <meta name="description" content>
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no, maximum-scale=1.0, user-scalable=0">

    

    

    <!-- stylesheets -->
    <link rel="stylesheet" href="/styles/cookbook.css">
    <link rel="stylesheet" href="/styles/fontawesome.css">
    
      <link rel="stylesheet" href="/styles/gitment.css">
    

    <!-- favicon -->
    
    <link rel="shortcut icon" href="/favicon.ico">
    

    

    

    <title>CatLib - 服务提供者 </title>
  </head>

  <body>
    
    
    <div id="cookbook" :class="{'with-summary' : withSummary}" v-cloak>
    <div class="cookbook-summary">
    
    <search placeholder="Type to search" :versions="versions" :root="root" v-model="searched" v-on:submit="searchSubmit" :disable="searchDisabled" v-on:disabled="setSearchDisabled"></search>
    <navigation :data="navigation" :web="web" :versions="versions" :root="root" active="v1/architecture/service-provider.html" :subnavdata="contentNavigation" :value="contentOffset" :searchdisabled="searchDisabled"></navigation>
    
</div>    <div class="cookbook-content" ref="content">
    
    <div class="cookbook-header" role="navigation">
        <header-tool :web="web" path="v1/architecture/service-provider.html" editor v-model="withSummary"></header-tool>
        <header-navigation :web="web" :versions="versions" :root="root"></header-navigation>
    </div>
    <div class="content-wrapper" @click="hidenSummary" :style="minHeightStyle">
        <checkout :navigation="navigation" :web="web" :versions="versions" v-model="checkout"></checkout>
        <div v-if="checkout" class="cookbook-search-results">
            <div id="search-noresults" v-show="searched == null">
                <section ref="section" class="markdown-section">
                    <h1 id="服务提供者"><a href="#服务提供者" class="headerlink" title="服务提供者"></a>服务提供者</h1><p>服务提供者是<code>组件</code>和<code>CatLib</code>联系的桥梁。同时也是CatLib启动的中心，所有的服务都是通过服务提供者定义的。</p>
<h2 id="名词定义"><a href="#名词定义" class="headerlink" title="名词定义"></a>名词定义</h2><ul>
<li><code>组件</code> 组件与CatLib没有任何关系，她们可以独立的运行在不同的框架中。</li>
<li><code>服务</code> 是由服务提供者将由<code>一个</code>或者<code>多个</code>组件组合而成，并提供一组可以被开发者使用的接口。</li>
<li><code>容器</code> CatLib 依赖注入容器。</li>
</ul>
<h2 id="架构图"><a href="#架构图" class="headerlink" title="架构图"></a>架构图</h2><p><img src="../imgs/architecture-diagram.svg" alt="architecture-diagram" style="max-width:1200px;"></p>
<h2 id="创建服务提供者"><a href="#创建服务提供者" class="headerlink" title="创建服务提供者"></a>创建服务提供者</h2><p>服务提供者是用来描述一个服务如何为使用者提供服务的，这些关系常常包括：服务是否是单例的，服务在构建后如何初始化等等。</p>
<p>服务提供者类的命名我们建议以：<code>Provider</code>开头，如：</p>
<ul>
<li><code>ProviderFileSystem.cs</code></li>
<li><code>ProviderNetwork.cs</code></li>
</ul>
<h5 id="为什么要使用服务提供者"><a href="#为什么要使用服务提供者" class="headerlink" title="为什么要使用服务提供者"></a>为什么要使用服务提供者</h5><ul>
<li>服务提供者类可以从目录结构清晰的明确哪个类是服务注册类，如果不使用服务提供者类，那么开发者无法快速明确哪一个类为框架提供了服务。</li>
<li>服务提供者类似于胶水，粘连了服务和框架，依赖注入是通过构造函数自动进行的，这样在服务的开发过程中甚至可以完全不依赖于框架进行开发。</li>
<li>服务提供者类可以用于启动某些程序，例如在服务提供者中的Init方法注册一些事件，当事件触发时启动某些程序。</li>
</ul>
<blockquote>
<p>服务提供者只是一个管理工具，请善用服务提供者来引导或管理你的组件，以便于组件之间互相组合和协作。请充分发挥你的想象吧！</p>
</blockquote>
<h5 id="写服务提供者和使用接口可能太麻烦？"><a href="#写服务提供者和使用接口可能太麻烦？" class="headerlink" title="写服务提供者和使用接口可能太麻烦？"></a>写服务提供者和使用接口可能太麻烦？</h5><p>有些人可能会批判，我明明一个简单的功能却要实现这么一大圈功能，意思是让代码显得太冗长，你必须定义接口然后实现它，再通过服务提供者注册。这要多敲多少代码！</p>
<p>对于小而简单的程序来说，以上说法并没有什么问题，在简单功能中接口通常是不必要的，将代码耦合到那些你认为不会改变的地方也是可行的，比如一次性的任务，或者一些原型或演示项目，毕竟这种灵活性会带来更多的代码量。<br>有时候的确不会改。而且小型的程序也不需要架构师，架构师们都是为大型项目服务的。</p>
<p>在大型项目中，接口是很有帮助的。和提升的代码灵活性、可测试性相比，多敲几下键盘花费的时间就显得微不足道了。</p>
<p>如果你在写小型程序的时候不想遵守接口原则，回退到原始模式，别觉得有什么问题，那没什么不对。但是你要为其带来的弊端做好评估。</p>
<h4 id="通过IServiceProvider来建立服务提供者"><a href="#通过IServiceProvider来建立服务提供者" class="headerlink" title="通过IServiceProvider来建立服务提供者"></a>通过IServiceProvider来建立服务提供者</h4><p>您的服务提供者类必须实现<code>CatLib.IServiceProvider</code>接口, 接口中包含<code>Register()</code>和<code>Init()</code>2个方法。</p>
<p>在<code>Register()</code>方法中，你<code>唯一</code>要做的事情就是<code>绑定服务实现</code>到服务容器，不要尝试在其中执行任何其它功能，否则将会引发一个<code>CodeStandardException</code>异常。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ProviderFileSystem</span> : <span class="title">IServiceProvider</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Init</span>(<span class="params"></span>)</span>&#123; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Register</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        App.Singleton&lt;IFileSystem, FileSystem&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>Init()</code>方法会在所有的服务提供者的<code>Register()</code>方法执行后执行，这意味着我们可以在<code>Init()</code>中访问其他服务提供者所提供的服务。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ProviderConfig</span> : <span class="title">IServiceProvider</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Init</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123; </span><br><span class="line">        <span class="keyword">var</span> fileSystem = App.Make&lt;IFileSystem&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Register</span>(<span class="params"></span>)</span>&#123; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="通过ServiceProvider来建立"><a href="#通过ServiceProvider来建立" class="headerlink" title="通过ServiceProvider来建立"></a>通过ServiceProvider来建立</h4><p>您还可以通过继承<code>ServiceProvider</code>来简化服务提供者的构建方式：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ProviderConfig</span> : <span class="title">ServiceProvider</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">override</span> <span class="keyword">void</span> <span class="title">Init</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123; </span><br><span class="line">        <span class="comment">// todo: </span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="注册服务提供者"><a href="#注册服务提供者" class="headerlink" title="注册服务提供者"></a>注册服务提供者</h2><p>如果框架的使用者想要使用某个服务，那么必须先对这个服务进行注册：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">App.Register(<span class="keyword">new</span> ProviderFileSystem());</span><br></pre></td></tr></table></figure>
<blockquote>
<p>注册了服务提供者并不意味着服务都会被立即实例化，通常情况下很多是延迟实例化的，只有真的用到它们的时候才会实例化。</p>
</blockquote>
<h2 id="覆盖服务提供者"><a href="#覆盖服务提供者" class="headerlink" title="覆盖服务提供者"></a>覆盖服务提供者</h2><p>通过<code>CatLib.IServiceProviderType</code>接口可以覆盖服务提供者，这往往在需要GUI支持的服务提供者中会非常有用。</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ProviderConfig</span> : <span class="title">IServiceProvider</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Init</span>(<span class="params"></span>)</span>&#123; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Register</span>(<span class="params"></span>)</span>&#123; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ProviderGUIConfig</span> : <span class="title">IServiceProvider</span>, <span class="title">IServiceProviderType</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Init</span>(<span class="params"></span>)</span>&#123; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Register</span>(<span class="params"></span>)</span>&#123; &#125;</span><br><span class="line">    <span class="keyword">public</span> Type BaseType </span><br><span class="line">    &#123; </span><br><span class="line">        <span class="keyword">get</span>&#123; <span class="keyword">return</span> <span class="keyword">typeof</span>(ProviderConfig); &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>例如:在Unity中GUI可视化编辑界面需要替换基础的服务提供者。<br><code>ProviderGUIConfig</code> 注册到框架后，会被框架识别为：<code>ProviderConfig</code></p>
</blockquote>
<h2 id="协同初始化"><a href="#协同初始化" class="headerlink" title="协同初始化"></a>协同初始化</h2><p>如果您希望协同初始化，那么需要实现<code>ICoroutineInit</code>或者覆盖<code>ServiceProvider</code>的<code>CoroutineInit</code>函数。</p>
<p>在原生CatLib.Core环境下协同初始化的调度器为同步调度器。在一些其他环境下可能会由环境的调度器来处理。</p>
<blockquote>
<p>协同初始化是扩展支持，所以需要先实现<code>IServiceProvider</code>接口。</p>
</blockquote>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ProviderConfig</span> : <span class="title">IServiceProvider</span>, <span class="title">ICoroutineInit</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Init</span>(<span class="params"></span>)</span>&#123; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Register</span>(<span class="params"></span>)</span>&#123; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> IEnumerator <span class="title">CoroutineInit</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="完整的例子"><a href="#完整的例子" class="headerlink" title="完整的例子"></a>完整的例子</h2><ul>
<li><p>设计服务接口<code>FileSystem/IFileSystem.cs</code>:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title">IFileSystem</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">HelloWorld</span>(<span class="params"></span>)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>开发服务实现<code>FileSystem/FileSystem.cs</code>:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">FileSystem</span> : <span class="title">IFileSystem</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">HelloWorld</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        Console.WriteLine(<span class="string">"hello world"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建服务提供者<code>FileSystem/ProviderFileSystem.cs</code>:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ProviderFileSystem</span> : <span class="title">IServiceProvider</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Init</span>(<span class="params"></span>)</span>&#123; &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Register</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>    &#123;</span><br><span class="line">        App.Singleton&lt;IFileSystem, FileSystem&gt;();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>创建框架入口文件，<code>Main.cs</code>:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> application = Application.New();</span><br><span class="line">application.Bootstrap();</span><br><span class="line">application.Register(<span class="keyword">new</span> ProviderFileSystem());</span><br><span class="line">application.Init();</span><br></pre></td></tr></table></figure>
</li>
<li><p>使用服务<code>Main.cs</code>:</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">App.Make&lt;IFileSystem&gt;().HelloWorld(); <span class="comment">// 输出:hello world</span></span><br></pre></td></tr></table></figure>
</li>
</ul>

                </section>

                
                    <div ref="comments" id="gitment-container"></div>
                
                
                <support :web="web" visiable></support>
            </div>
            <div v-if="searched != null" id="search-result" class="search-result" v-cloak>
                <p v-if="searched.results.length > 0" class="search-title">
                    与"{{ searched.keyword }}"相关的内容{{searched.results.length}}条
                </p>
                <p v-else class="search-title">无搜索结果可以匹配"{{ searched.keyword }}"</p>
                <div v-for="(record) in searched.results" class="searched-line">
                    <h3>
                        <a :href="'/' + record.href + '#!' + encodeURI(anchorEscaping(record.hash))" @click="clearSearch">
                            {{ record.hash }}
                        </a>
                    </h3>
                    <ul>
                        <li><i>{{ record.page }} <span v-if="record.page_title != ''">- {{ record.page_title }}</span></i> <i>score:<span>{{ record.score }}</span></i></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
    
</div></div>

<script>
window.onload = function(){  
    new Vue({
        el : '#cookbook',
        data: { 
            navigation : {"navigation":[{"levels":[{"text":"CatLib","href":"/"},{"text":"核心库","href":"index.html"}]},{"divider":true},{"text":"起步"},{"text":"介绍","href":"index.html"},{"text":"风格指南","href":"style.html"},{"text":"常见问题","href":"faq.html"},{"text":"已知BUG","href":"bug.html"},{"text":"贡献指南","href":"contribution.html"},{"text":"更新日志","href":"upgrade.html"},{"text":"迁移指南","href":"migration.html"},{"text":"系统架构"},{"text":"服务提供者","href":"architecture/service-provider.html"},{"text":"应用程序","href":"architecture/application.html"},{"text":"服务容器","href":"architecture/container.html"},{"text":"服务门面","href":"architecture/facade.html"},{"text":"框架组件"},{"text":"事件系统","href":"components/event.html"},{"text":"管理器模版","href":"components/template.html"},{"text":"辅助函数"},{"text":"数组","href":"helper/arr.html"},{"text":"字符串","href":"helper/str.html"},{"text":"字典","href":"helper/dict.html"},{"text":"时间","href":"helper/system-time.html"},{"text":"线程静态","href":"helper/thread-static.html"},{"text":"通用","href":"helper/util.html"},{"text":"数据结构"},{"text":"有序集","href":"data-structure/sort-set.html"},{"text":"快速列表","href":"data-structure/quick-list.html"},{"text":"环型缓冲区","href":"data-structure/ring-buffer.html"},{"text":"内存存储","href":"data-structure/memory-storage.html"},{"text":"过滤器链","href":"data-structure/filter-chain.html"},{"text":"流"},{"text":"包装流","href":"stream/wrapper-stream.html"},{"text":"管道流","href":"stream/pipeline-stream.html"},{"text":"存储流","href":"stream/storage-stream.html"},{"text":"组合流","href":"stream/combine-stream.html"},{"text":"分片流","href":"stream/segment-stream.html"},{"divider":true},{"text":"Power by CatLib","href":"https://github.com/CatLib","external":true}]},
            web : {"navigation":[{"type":"versions","mobile":true},{"type":"menu","text":"组件库","mobile":true,"list":[{"text":"ILRuntime支持库","href":"https://ilruntime.catlib.io"}]},{"type":"normal","text":"English","href":"https://catlib.io/lasted/index.html","mobile":true},{"type":"icon","fontawesome":"github","href":"https://github.com/CatLib/Core","mobile":true}],"tool":{"editor":{"text":"编辑","href":"https://github.com/CatLib/catlib-cn.io/tree/2.0/","external":true}},"support":{"label":["在文档中没有找到您需要的内容？","尝试在左侧搜索栏中搜索，或者{text}"],"text":"在GitHub中发起提问","href":"https://github.com/CatLib/catlib-cn.io/issues","external":true}},
            versions: {
                current :  {"test":"^v1\\/","name":"v1.4","active":"Latest(v1.4)","data":"v1"},
                list: [{"test":"^v1\\/","name":"v1.4","active":"Latest(v1.4)","data":"v1"},{"test":"^v2\\/","name":"v2.0","active":"Latest(v2.0)","data":"v2"}]
            },
            withSummary : true,
            isPC : null,
            checkout: false,
            root: "/",
            contentNavigation: [],
            contentOffset : { 'offsetTop' : 0, 'height' : 0 },
            searched: null,
            searchDisabled: localStorage.getItem("search-input-disabled") == 'true',
            clientHeight : 0
        },
        methods :{
            testPC : function(){ 
                var userAgentInfo = navigator.userAgent;
                var deviceReg = [
                    /(MI(\s+)|2013022|2013023|HM|2014011|2014501|2014813|2014811|2014812|2014817|2014818|2014819|2014502|2015|xiaomi).*/i,
                    /(MI(.*|\s*)PAD).*/i,
                    /(iPhone | iPod).*/i,
                    /(iPad).*/i,
                    /(Android).*/i,
                    /(iPhone|iPad|iPod|iOS).*/i,
                    /(windows(.*|\s*)phone).*/i
                ];
                var flag = true;
                for (var v = 0; v < deviceReg.length; v++) {
                    if (deviceReg[v].test(userAgentInfo)) {
                        flag = false;
                        break;
                    }
                }
                
                return flag;
            },
            hidenSummary : function(){
                if(!this.isPC)
                {
                    this.withSummary = false;
                }
            },
            bindMinHeight: function(){
                var vue = this;
                window.addEventListener("resize", function(){
                    vue.clientHeight = document.documentElement.clientHeight - 50;
                }, false);
                this.clientHeight = document.documentElement.clientHeight - 50;
            },
            bindAnchor : function(){
                if(this.$refs.section == undefined){
                    return;
                }
                window.addEventListener("hashchange", this.hashChange, false);
                window.addEventListener("resize", this.refreshContentNavigation, false);
                var elements = this.$refs.section.getElementsByTagName("a");
                var vue = this;
                for(var index = 0; index < elements.length; index++){
                    let element = elements[index];
                    let href = element.getAttribute("href");
                    if(href.length <= 0 || href[0] != "#"){
                        continue;
                    }

                    element.addEventListener('click', function(event){
                        location.hash = "!" + encodeURI(decodeURI(vue.anchorEscaping(element.hash.substring(1))));
                        event.preventDefault();
                    }, false);
                }

                this.refreshContentNavigation();
            },
            refreshContentNavigation : function(){
                if(this.$refs.section == undefined || !this.supportSubnav()){
                    return;
                }
                var subnavIndex = 0;
                var elements = this.$refs.section.getElementsByClassName("headerlink");
                var subnav = [];
                for(var index=0; index < elements.length; index++){
                    var element = elements[index];
                    if(element.parentElement.nodeName == "H2"){
                        subnav[subnavIndex++] = {'text' : element.title , 'hash' : "!" + element.hash.substring(1), 'offsetTop' : element.offsetTop};
                    }
                }
                this.contentNavigation = subnav;
            },
            hashChange : function(){
                var locationHash = location.hash.replace(/^#!/ig, "#");
                if(locationHash == ''){
                    return;
                }
                locationHash = decodeURI(locationHash);
                var hashes = this.$refs.section.getElementsByClassName("headerlink");
                var target = null;
                for(var index=0; index < hashes.length; index++){
                    var hash = hashes[index];
                    if(decodeURI(hash.hash) == locationHash){
                        target = hash;
                        break;
                    }
                }
                
                if(target == null){
                    return;
                }

                var top = target.offsetTop - 20; 
                
                if(top > 0)
                {
                    var vue = this;
                    $('.cookbook-content').animate({scrollTop:top}, 500, function(){
                        if(!vue.isPC){
                            vue.withSummary = false;
                        }
                    });
                }        
            },
            bindScroll : function(){
                if(!this.supportSubnav()){
                    return;
                }
                this.$refs.content.addEventListener("scroll", this.scrollChange, false);
            },
            scrollChange : function(e){
                this.contentOffset = { 
                    'offsetTop' : this.$refs.content.scrollTop,
                    'height' : this.$refs.content.scrollHeight - this.$refs.content.offsetHeight
                };
            },
            supportSubnav : function(){
                if(this.navigation.subnav != undefined && this.navigation.subnav == false){
                    return false;
                }
                return true;
            },
            clearSearch: function(){
                this.searched = null;
                this.$nextTick(function(){
                    this.hashChange();
                });
            },
            searchSubmit: function(){
                if(!this.isPC)
                {
                    this.withSummary = false;
                }
            },
            anchorEscaping : function(str){
                return str.replace(' ', '-').replace('.', '-');
            },
            setSearchDisabled : function(value){
                this.searchDisabled = value;
            },
            initComments : function(){
                
                    var vue = this;
                    var theme = {
                        render : function(state, instance) {
                            var container = document.createElement('div');
                            container.lang = "en-US";
                            container.className = 'gitment-container gitment-root-container';
                            container.appendChild(instance.renderHeader(state, instance));
                            container.appendChild(instance.renderComments(state, instance));
                            container.appendChild(instance.renderEditor(state, instance));
                            return container;
                        },
                    }

                    var gitment = new Gitment({
                        id : 'catlib-cn:v1/architecture/service-provider.html',
                        owner: 'catlib',
                        repo: 'catlib-cn.io',
                        oauth: {
                            client_id: '3620f7cdd1c50b4b6e3c',
                            client_secret: '50664006a799cb29b27e8358b88a6a4580e8dc0c',
                            cross_server: 'https://31225080.ap-southeast-1.fc.aliyuncs.com/2016-08-15/proxy/gitment/gitment-cross/',
                        },
                        labels : [
                            'CatLib'
                        ],
                        link: 'https://cn.catlib.io/v1/architecture/service-provider.html',
                        maintainer: ["yb199478"],
                        theme : theme,
                        perPage : 30,
                    });

                    gitment.render(this.$refs.comments);
                
            },
        },mounted : function() {
            this.isPC = this.withSummary = this.testPC();
            this.$nextTick(function(){
                this.bindScroll();
                this.bindAnchor();
                this.hashChange();
                this.initComments();
                this.bindMinHeight();
            });
        },
        watch: {
            searched : function(){
                $('.cookbook-content').animate({scrollTop:0}, 0);
            }
        },
        computed:{
            minHeightStyle : function()
            {
                return { 'min-height' : this.clientHeight + "px" }
            }
        }
    });
};
</script>
    

    
    <script src="/scripts/cookbook.js"></script>
    
      <script src="/scripts/gitment.js"></script>
    
    
    
  </body>
</html>